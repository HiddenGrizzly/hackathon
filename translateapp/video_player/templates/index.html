<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Video Player</title>
    <link
      href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css"
      rel="stylesheet"
    />
    <link href="/static/video-js/video-js.min.css" rel="stylesheet" />
    <style>
      body {
        display: flex;
        height: 100vh;
        margin: 0;
        color: white;
        background-image: url(/static/images/rm373batch5-18.jpg);
        background-repeat: no-repeat;
        background-size: cover;
      }
      #left-panel {
        width: 30%;
        padding: 20px;
        border-right: 1px solid #ccc;
      }
      #right-panel {
        width: 70%;
        padding: 20px;
      }
      #video-container {
        margin-top: 20px;
      }
    </style>
  </head>
  <body>
    <div id="left-panel" class="container">
      <h2 class="m-4">Tìm kiếm từ vựng</h2>
      <form id="search-form">
        <div class="form-group">
          <label for="text-input">Nhập từ cần tìm:</label>
          <input type="text" id="text-input" name="text" class="form-control" />
        </div>
        <button type="submit" class="btn btn-primary">Tìm kiếm video</button>
      </form>
    </div>
    <div id="right-panel" class="container">
      <h1 class="m-5">Video hướng dẫn:</h1>
      <div id="video-container" class="m-5">
        <video
          id="video-player"
          class="video-js vjs-default-skin"
          controls
          preload="auto"
          width="640"
          height="264"
        >
          <source src="" type="video/mp4" />
        </video>
      </div>
    </div>
    <script src="https://code.jquery.com/jquery-3.5.1.min.js"></script>
    <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/js/bootstrap.min.js"></script>
    <script src="/static/video-js/video.min.js"></script>
    <script>
      document
        .getElementById("search-form")
        .addEventListener("submit", function (event) {
          event.preventDefault();
          const textInput = document.getElementById("text-input").value;
          fetch("/search_videos", {
            method: "POST",
            headers: {
              "Content-Type": "application/x-www-form-urlencoded",
            },
            body: "text=" + encodeURIComponent(textInput),
          })
            .then((response) => response.json())
            .then((data) => {
              const videoContainer = document.getElementById("video-container");
              videoContainer.innerHTML = ""; // Clear previous player

              if (data.length > 0) {
                const videoPlayer = document.createElement("video");
                videoPlayer.id = "video-player";
                videoPlayer.className = "video-js vjs-default-skin";
                videoPlayer.controls = true;
                videoPlayer.preload = "auto";
                videoPlayer.autoplay = true;
                videoPlayer.width = 640;
                videoPlayer.height = 264;

                const source = document.createElement("source");
                source.src = "/static/videos/" + data[0];
                source.type = "video/mp4";
                videoPlayer.appendChild(source);

                videoContainer.appendChild(videoPlayer);
                const player = videojs(videoPlayer);

                let currentIndex = 0;

                player.on("ended", function () {
                  currentIndex++;
                  if (currentIndex < data.length) {
                    player.src({
                      type: "video/mp4",
                      src: "/static/videos/" + data[currentIndex],
                    });
                    player.load();
                    player.play();
                  }
                });

                player.ready(function () {
                  player.play();
                });
              } else {
                alert("Không tìm thấy video nào phù hợp.");
              }
            });
        });
    </script>
  </body>
</html>
